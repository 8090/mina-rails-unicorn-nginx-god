{"tagline":"An example deployment configuration using Mina for server running Rails app, Unicorn, nginx, and God.","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Mina+Rails+Unicorn+Nginx+God","google":"","body":"# Mina + Rails + Unicorn + Nginx + God\r\n======================================\r\n\r\nAn example deployment configuration using [Mina](https://github.com/nadarei/mina) for deployment.\r\n\r\nDeploys and updates Rails application and config files for [Unicorn](http://unicorn.bogomips.org/), [nginx](http://wiki.nginx.org/Main), and [God](http://godrb.com/).\r\n\r\n\"Why?\"\r\n------\r\n\r\nWhen I've started using Mina for deployment, these examples was the thing I needed most.\r\n\r\nNot to just copy and use, but also to read and understand.\r\n\r\nAfter a few days of tinkering I've came up with this setup.\r\n\r\nSo I thought, why not share? I hope it can be useful for somebody, so that one can see, learn, understand, and use.\r\n\r\n\"How?\"\r\n------\r\n\r\nThis example assumes following:\r\n\r\n* you're running Ubuntu in Vagrant locally (quite nice tool I'd say. Check out [RBates Railscast](http://railscasts.com/episodes/292-virtual-machines-with-vagrant) on this subject)\r\n* you already have a user, that will be running deployment and all the server stuff\r\n* this user have sudo privileges OR you have a separate user that have sudo privileges. You'll need sudoer for setup_extras and config:link tasks. If you don't have separate sudoer, script will assume that deployer have all the necessary sudo rights. If you know workaround, please, let me know about it!\r\n* you already installed and configured git, rvm (global installation preferred) and nginx, at least\r\n* probably something else I forgot at the moment. Don't expect flawless deploy from scratch anyway\r\n\r\nExample deployment to local vagrant virtual machine:\r\n```bash\r\n# copy config/deploy.rb to $YOUR_APP/config/deploy.rb\r\n# copy lib/mina to $YOUR_APP/lib\r\n# edit common settings and anything you like in config/deploy.rb\r\n# edit lib/mina/servers/vagrant.rb to match your server configuration\r\nmina vagrant init\r\nmina vagrant setup\r\nmina vagrant setup_extras\r\nmina vagrant god:setup\r\nmina vagrant nginx:setup    # needs sudo. see lib/mina/nginx.rb:10\r\nmina vagrant config:upload\r\nmina vagrant config:link    # needs sudo to copy god and unicorn service control scripts\r\nmina vagrant deploy\r\nmina vagrant nginx:restart  # or nginx:start\r\nmina vagrant god:start      # it will also run unicorn automagically\r\n```\r\nYou should be up and running now. Yay!\r\n\r\n\"What now?\"\r\n-----------\r\n\r\nYou can check God status:\r\n\r\n    mina vagrant god:status\r\n\r\n...or overall processes status/health:\r\n\r\n    mina vagrant health\r\n\r\nYou can customize output of this command in lib/mina/extras.rb:33\r\n\r\nJust make sure you have no bash zombies, running around, eating your CPU. Just in case...\r\n\r\nTo deploy next release, just run\r\n\r\n    mina vagrant deploy\r\n\r\nIf you've changed some of the config files for god/unicorn/nginx, you can upload them to server with `mina vagrant config:upload`.\r\n\r\nIf changed code includes unicorn or god control script (service), you will also need to run `mina vagrant config:link`, which require sudo privileges. Keep in mind, that any nginx controlling task also requires sudo! Those are: stop, start, restart, reload, and status.\r\n\r\nIndividual tasks also available, like `god:upload`, or `unicorn:link`.\r\n\r\nYou can also run `mina vagrant god:parse:unicorn` to see how god's unicorn config file will look like without uploading it to server. Very useful for debugging!\r\n\r\nJust check out task files under lib/mina directory, most of the code there is quite self-explanatory!\r\n    \r\n\"This code sucks!\"\r\n------------------\r\n\r\nWell, most probably it is. But it is the code I'm successfully using for production deployment, and if you think you can improve\r\nit or just have a better idea regarding anything described here - just send me an email or pull request.\r\n\r\nMe\r\n--\r\n\r\n[Github](https://github.com/alfuken)\r\n[Blog](http://alfuken.tumblr.com/)\r\n[Twitter](http://twitter.com/alfuken)\r\n"}